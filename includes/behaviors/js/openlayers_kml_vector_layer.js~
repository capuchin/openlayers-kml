
/**
 * @file
 * Main JS file for openlayers_kml
 *
 * @ingroup openlayers_kml
 */
Drupal.behaviors.openlayers_kml_vector_layer = function(context) {

//console.log("hi");

  var data = $(context).data('openlayers');
  if (data && data.map.behaviors['openlayers_kml_vector_layer']) {
    var features = data.map.behaviors['openlayers_kml_vector_layer'].features;



    // Create options and layer
    var options = {
      drupalID: 'openlayers_kml_vector_layer'
    };
    var styleMap = Drupal.openlayers.getStyleMap(data.map, options.drupalID);
    var dataLayer = new OpenLayers.Layer.Vector(Drupal.t("Data Layer"), options);
    
    // Add features, styles, and layers
    dataLayer.styleMap = styleMap;
//    Drupal.openlayers.addFeatures(data.map, dataLayer, features);
//    data.openlayers.addLayer(dataLayer);




		var layer = new OpenLayers.Layer.GML("KML", features[0].kml, {
  	 format: OpenLayers.Format.KML,
		 projection: "EPSG:" + features[0].projection
		});




		//var vector = new OpenLayers.Feature.Vector()

		// Transform 
    if (features[0].projection) {
      if (features[0].projection !== data.map.projection){
        var featureProjection = new OpenLayers.Projection("EPSG:" + features[0].projection);
        var mapProjection = new OpenLayers.Projection("EPSG:" + data.map.projection);
				console.log(featureProjection);
				console.log(mapProjection);
console.log(layer);
// newFeature.geometry.transform(featureProjection, mapProjection);
//OpenLayers.geometry.transform(featureProjection, mapProjection);
      }
    }
		data.openlayers.addLayer(layer);


  }
};
